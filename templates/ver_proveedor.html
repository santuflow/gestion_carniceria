<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>{{ p.nombre }} ‚Äì Proveedor</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='proveedor_perfil.css') }}">
  <style>
    /* Peque√±os toques sin pisar tu CSS principal */
    .topbar{position:sticky;top:0;background:#0f172a;border-bottom:1px solid #1f2a44;z-index:20}
    .topbar-inner{max-width:1100px;margin:auto;display:grid;grid-template-columns:auto 1fr auto;gap:12px;align-items:center;padding:10px 16px}
    .topbar h1{margin:0;text-align:center;font-size:1.1rem;color:#e2e8f0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .btn{border:1px solid #334155;padding:8px 12px;border-radius:10px;text-decoration:none;color:#e2e8f0;background:#111827;display:inline-flex;align-items:center;gap:6px}
    .btn:hover{filter:brightness(1.05)}
    .btn.primary{background:#0b5; border-color:#094; color:#041}
    .perfil-wrapper{max-width:1100px;margin:18px auto;padding:0 16px}
    .perfil-visual{position:relative;margin-bottom:14px}
    .perfil-visual .portada img{width:100%;height:240px;object-fit:cover;border-radius:14px}
    .perfil-visual .avatar{position:absolute;bottom:-36px;left:18px}
    .perfil-visual .avatar img{width:96px;height:96px;border-radius:999px;border:4px solid #0f172a;object-fit:cover;background:#0b1020}
    .card{background:#0b1020;border:1px solid #1f2a44;border-radius:14px;padding:16px;margin-top:48px}
    .perfil-datos{display:grid;grid-template-columns:1fr auto;gap:16px}
    .muted{color:#94a3b8}
    .desc{margin-top:8px;color:#cbd5e1;white-space:pre-wrap}
    .chips{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
    .chip{background:#111827;border:1px solid #1f2a44;color:#cfe0ff;border-radius:999px;padding:4px 10px;font-size:.85rem}
    .productos h3{margin:0 0 10px}
    .grid-productos{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:14px}
    @media (max-width:1024px){.grid-productos{grid-template-columns:repeat(3,1fr)}}
    @media (max-width:720px){.grid-productos{grid-template-columns:repeat(2,1fr)} .perfil-visual .portada img{height:180px}}
    .prod-card{background:#0a1222;border:1px solid #1f2a44;border-radius:14px;overflow:hidden;display:flex;flex-direction:column}
    .prod-img img{width:100%;height:160px;object-fit:cover;background:#0b1020}
    .prod-info{padding:10px 12px;display:flex;align-items:center;justify-content:space-between;gap:8px}
    .precio{font-weight:700;color:#22d3ee}
    .tools{display:flex;gap:8px;align-items:center;justify-content:flex-end;margin-top:8px}
  </style>
</head>
<body class="perfil-body">
  <header class="topbar">
    <div class="topbar-inner">
      <a class="btn" href="{{ url_for('proveedores') }}" aria-label="Volver a proveedores">‚Üê Volver</a>
      <h1 title="{{ p.nombre }}">{{ p.nombre }}</h1>

      <div class="tools">
        <button class="btn" id="copy-link" type="button" aria-label="Copiar enlace">üîó Copiar enlace</button>
        {% if es_dueno %}
          <a class="btn" href="{{ url_for('soy_proveedor') }}">‚úèÔ∏è Editar perfil</a>
          <!-- Dejalo preparado por si quer√©s enganchar ruta para editar solo precios -->
          <a class="btn primary" href="{{ url_for('soy_proveedor') }}#productos">üí≤ Actualizar precios</a>
        {% else %}
          <span></span>
        {% endif %}
      </div>
    </div>
  </header>

  <main class="perfil-wrapper">
    <!-- Portada + avatar -->
    <section class="perfil-visual" aria-label="Im√°genes del proveedor">
      <div class="portada">
        <img
          src="{{ p.portada_path or url_for('static', filename='img/placeholder_portada.jpg') }}"
          alt="Portada de {{ p.nombre }}"
          loading="lazy"
          onerror="this.onerror=null;this.src='{{ url_for('static', filename='img/placeholder_portada.jpg') }}';"
        >
      </div>
      <div class="avatar">
        <img
          src="{{ p.avatar_path or url_for('static', filename='img/placeholder_avatar.png') }}"
          alt="Foto de {{ p.nombre }}"
          loading="lazy"
          onerror="this.onerror=null;this.src='{{ url_for('static', filename='img/placeholder_avatar.png') }}';"
        >
      </div>
    </section>

    <!-- Datos -->
    <section class="perfil-datos card" aria-label="Datos del proveedor">
      <div class="datos-izq">
        <h2 style="margin:0">{{ p.nombre }}</h2>
        {% if p.direccion %}
          <p class="muted">{{ p.direccion }}</p>
        {% endif %}

        {% if p.descripcion %}
          <p class="desc">{{ p.descripcion }}</p>
        {% endif %}

        {% if zonas and zonas|length %}
          <div class="chips" aria-label="Zonas de reparto">
            {% for z in zonas %}
              <span class="chip">{{ z }}</span>
            {% endfor %}
          </div>
        {% endif %}
      </div>

      <div class="datos-der">
        {% if p.contacto %}
          <a
            class="btn large"
            href="https://wa.me/{{ (p.contacto or '') | replace(' ', '') | replace('+', '') | replace('-', '') | replace('(', '') | replace(')', '') }}"
            target="_blank"
            rel="noopener"
            aria-label="Contactar por WhatsApp"
          >
            üí¨ Contactar por WhatsApp
          </a>
          <p class="muted" style="margin-top:6px">{{ p.contacto }}</p>
        {% endif %}
      </div>
    </section>

    <!-- Productos -->
    <section class="productos card" aria-label="Productos">
      <div style="display:flex;align-items:center;justify-content:space-between;gap:10px">
        <h3 style="margin:0">Productos</h3>
        {% if productos %}
          <span class="muted">{{ productos|length }} √≠tem{{ '' if productos|length==1 else 's' }}</span>
        {% endif %}
      </div>

      {% if productos %}
        <div class="grid-productos">
          {% for prod in productos %}
            <article class="prod-card">
              <div class="prod-img">
                <img
                  src="{{ prod.imagen_path or url_for('static', filename='img/placeholder_producto.jpg') }}"
                  alt="{{ prod.nombre }}"
                  loading="lazy"
                  onerror="this.onerror=null;this.src='{{ url_for('static', filename='img/placeholder_producto.jpg') }}';"
                >
              </div>
              <div class="prod-info">
                <h4 style="margin:0; font-size:1rem">{{ prod.nombre }}</h4>
                <p class="precio" aria-label="Precio">{{ prod.precio }}</p>
              </div>
            </article>
          {% endfor %}
        </div>
      {% else %}
        <p class="muted" style="margin-top:8px">A√∫n no hay productos publicados.</p>
      {% endif %}
    </section>
  </main>

  <script>
    // Copiar enlace del perfil
    document.getElementById('copy-link')?.addEventListener('click', async () => {
      try {
        await navigator.clipboard.writeText(window.location.href);
        const b = document.getElementById('copy-link');
        const old = b.textContent;
        b.textContent = '‚úÖ Copiado';
        setTimeout(()=> b.textContent = old, 1500);
      } catch (e) {
        alert('No se pudo copiar el enlace');
      }
    });
  </script>
</body>
</html>
