<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Registro de Proveedor</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='proveedor.css') }}">
</head>
<body class="fondo-proveedor">
  <header class="topbar">
    <div class="topbar-inner">
      <h1 class="titulo">Perfil de Proveedor</h1>
      <a href="{{ url_for('proveedores') }}" class="btn volver">← Volver</a>
    </div>
  </header>

  <main class="proveedor-layout">
    <!-- Portada + avatar con previsualización -->
    <section class="perfil-visual">
      <div class="portada-wrapper">
        <img id="preview-portada" class="portada" src="{{ url_for('static', filename='img/placeholder_portada.jpg') }}" alt="Portada">
        <label class="btn archivo">
          Cambiar portada
          <input type="file" name="portada" id="input-portada" accept="image/*" form="form-proveedor" required>
        </label>
      </div>

      <div class="avatar-wrapper">
        <img id="preview-avatar" class="avatar" src="{{ url_for('static', filename='img/placeholder_avatar.png') }}" alt="Avatar">
        <label class="btn archivo small">
          Foto de perfil
          <input type="file" name="avatar" id="input-avatar" accept="image/*" form="form-proveedor">
        </label>
      </div>
    </section>

    <form id="form-proveedor" action="/publicar_proveedor" method="POST" enctype="multipart/form-data" class="proveedor-form">

      <section class="grid-datos">
        <div class="form-col">
          <label>Nombre del negocio</label>
          <input type="text" name="nombre" placeholder="Ej: Frigorífico La Buena Carne" required>

          <label>Dirección / zona</label>
          <input type="text" name="direccion" placeholder="Calle y localidad" required>

          <label>Zonas de reparto</label>
          <select name="zonas_reparto[]" multiple required>
            <option>Capital Federal</option>
            <option>Zona Norte</option>
            <option>Zona Sur</option>
            <option>Zona Oeste</option>
            <option>Avellaneda</option>
            <option>Lanús</option>
            <option>Quilmes</option>
            <option>Berazategui</option>
            <option>Florencio Varela</option>
            <option>La Plata</option>
            <option>Ensenada</option>
            <option>Monte Grande</option>
            <option>Lomas de Zamora</option>
            <option>Banfield</option>
            <option>San Justo</option>
            <option>Castelar</option>
            <option>Ituzaingó</option>
            <option>Haedo</option>
            <option>Moreno</option>
            <option>Merlo</option>
            <option>Pilar</option>
            <option>Escobar</option>
            <option>San Miguel</option>
            <option>José C. Paz</option>
            <option>Villa Ballester</option>
            <option>San Martín</option>
            <option>San Isidro</option>
            <option>Vicente López</option>
            <option>Tigre</option>
            <option>San Fernando</option>
            <option>Luján</option>
            <option>Campana</option>
            <option>Zárate</option>
          </select>
        </div>

        <div class="form-col">
          <label>Contacto (WhatsApp o teléfono)</label>
          <input type="text" name="contacto" placeholder="+54 9 11 1234-5678" required>

          <label>Descripción general</label>
          <textarea name="descripcion" rows="4" placeholder="Ej: Reparto diario. Mayores y minoristas. Vacuno, cerdo, pollo, congelados..."></textarea>
        </div>
      </section>

      <!-- Productos -->
      <section class="productos-bloque">
        <div class="productos-header">
          <h2>Productos</h2>
          <button type="button" id="btn-agregar" class="btn secundario">+ Agregar otro producto</button>
        </div>

        <div id="productos-container" class="productos-grid">
          <div class="producto-item">
            <div class="producto-campos">
              <input type="text" name="producto_nombre[]" placeholder="Nombre del producto" required>
              <input type="text" name="producto_precio[]" placeholder="Precio por kg o unidad" required>
              <label class="btn archivo small">
                Foto
                <input type="file" name="producto_imagen[]" accept="image/*" required>
              </label>
            </div>
          </div>
        </div>
      </section>

      <div class="acciones">
        <button type="submit" class="btn publicar">Publicar proveedor</button>
      </div>
    </form>
  </main>

  <script>
    // Previews portada/avatar
    const inputPortada = document.getElementById('input-portada');
    const previewPortada = document.getElementById('preview-portada');
    const inputAvatar = document.getElementById('input-avatar');
    const previewAvatar = document.getElementById('preview-avatar');

    if (inputPortada) {
      inputPortada.addEventListener('change', e => {
        const f = e.target.files?.[0];
        if (f) previewPortada.src = URL.createObjectURL(f);
      });
    }
    if (inputAvatar) {
      inputAvatar.addEventListener('change', e => {
        const f = e.target.files?.[0];
        if (f) previewAvatar.src = URL.createObjectURL(f);
      });
    }

    // Agregar productos
    const cont = document.getElementById('productos-container');
    document.getElementById('btn-agregar').addEventListener('click', () => {
      const div = document.createElement('div');
      div.className = 'producto-item';
      div.innerHTML = `
        <div class="producto-campos">
          <input type="text" name="producto_nombre[]" placeholder="Nombre del producto" required>
          <input type="text" name="producto_precio[]" placeholder="Precio por kg o unidad" required>
          <label class="btn archivo small">
            Foto
            <input type="file" name="producto_imagen[]" accept="image/*" required>
          </label>
          <button type="button" class="btn danger quitar">Quitar</button>
        </div>
      `;
      div.querySelector('.quitar').addEventListener('click', () => div.remove());
      cont.appendChild(div);
    });
  </script>
</body>
</html>
